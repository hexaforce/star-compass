class t{constructor(t,i="rgba(0, 200, 200, 0.8)",s="rgba(200, 0, 0, 0.8)"){this.canvas=t,this.ctx=this.canvas.getContext("2d",{antialias:!0}),this.radius=this.canvas.width/2,this.color=i,this.indicator=s,this.currentAngle=0;const e=window.devicePixelRatio||1,h=2*this.radius,a=2*this.radius;this.canvas.width=h*e,this.canvas.height=a*e,this.canvas.style.width=`${h}px`,this.canvas.style.height=`${a}px`,this.ctx.scale(e,e),this.center={x:h/2,y:a/2},this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high",this.ctx.fillStyle=this.color,this.ctx.strokeStyle=this.color,this.drawRotatedStars(this.currentAngle)}drawRotatedStars(t){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight),this.ctx.save(),this.ctx.translate(this.center.x,this.center.y),this.ctx.rotate(t*Math.PI/180),this.ctx.translate(-this.center.x,-this.center.y),this.drawOuterTicks(),this.draw4PointedStar(.875*this.radius,.17*this.radius,0),this.draw4PointedStar(.55*this.radius,.1*this.radius,Math.PI/4),this.ctx.restore(),this.ctx.save();const i=.05*this.radius,s=this.center.y-.95*this.radius;this.ctx.fillStyle=this.indicator,this.ctx.strokeStyle=this.indicator,this.drawAndClear([{x:this.center.x,y:s+1.8*i},{x:this.center.x-i,y:s},{x:this.center.x+i,y:s}]),this.ctx.fill(),this.ctx.restore()}drawOuterTicks(){const t=this.radius/40,i=2.5*t,s=.7*this.radius,e=.8*this.radius;this.drawCircle(.685*this.radius,this.radius/40),this.drawCircle(.585*this.radius,this.radius/150),this.drawCircle(.485*this.radius,this.radius/60),this.drawCircle(.39*this.radius,this.radius/120),this.drawCircle(.365*this.radius,this.radius/180),this.drawDots(.44*this.radius,24,.01*this.radius),this.drawTicks(s,t,i,e),[{angle:0,text:"N"},{angle:90,text:"E"},{angle:180,text:"S"},{angle:270,text:"W"}].forEach((t=>{const i=(t.angle-90)*Math.PI/180,s=.925*this.radius,e=this.center.x+s*Math.cos(i),h=this.center.y+s*Math.sin(i),a=this.radius/6;this.ctx.save(),this.ctx.font=`bold ${a}px Arial`;const r=.3*a,c=this.ctx.measureText(t.text).width+2*r,n=a+2*r;this.ctx.translate(e,h),this.ctx.rotate(i+Math.PI/2),this.ctx.globalCompositeOperation="destination-out",this.ctx.fillRect(-c/2,-n/2,c,n),this.ctx.globalCompositeOperation="source-over",this.ctx.fillStyle="transparent",this.ctx.fillRect(-c/2,-n/2,c,n),this.ctx.fillStyle=this.color,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(t.text,0,0),this.ctx.restore()})),[{angle:45,text:"NE"},{angle:135,text:"SE"},{angle:225,text:"SW"},{angle:315,text:"NW"}].forEach((t=>{const i=(t.angle-90)*Math.PI/180,s=.58*this.radius,e=this.center.x+s*Math.cos(i),h=this.center.y+s*Math.sin(i),a=this.radius/13;this.ctx.save(),this.ctx.font=`bold ${a}px Arial`;const r=.3*a,c=this.ctx.measureText(t.text).width+2*r,n=a+2*r;this.ctx.translate(e,h),this.ctx.rotate(i+Math.PI/2),this.ctx.globalCompositeOperation="destination-out",this.ctx.fillRect(-c/2,-n/2,c,n),this.ctx.globalCompositeOperation="source-over",this.ctx.fillStyle="transparent",this.ctx.fillRect(-c/2,-n/2,c,n),this.ctx.fillStyle=this.color,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(t.text,0,0),this.ctx.restore()}))}drawCircle(t,i){this.ctx.beginPath(),this.ctx.arc(this.center.x,this.center.y,t,0,2*Math.PI),this.ctx.lineWidth=i,this.ctx.stroke()}drawDots(t,i,s){for(let e=0;e<i;e++){const h=2*e*Math.PI/i,a=this.center.x+t*Math.cos(h),r=this.center.y+t*Math.sin(h);this.ctx.beginPath(),this.ctx.arc(a,r,s,0,2*Math.PI),this.ctx.fill()}}drawTicks(t,i,s,e){this.ctx.lineWidth=.5,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.font=this.radius/14+"px Arial";for(let h=0;h<360;h+=1){const a=(h-90)*Math.PI/180,r=Math.cos(a),c=Math.sin(a);let n=i;h%5==0&&(n=s),this.ctx.beginPath(),this.ctx.moveTo(this.center.x+t*r,this.center.y+t*c),this.ctx.lineTo(this.center.x+(t+n)*r,this.center.y+(t+n)*c),this.ctx.stroke(),h%15==0&&h%90!=0&&this.drawAngleLabel(h,a,e)}for(let t=0;t<360;t+=45){const i=(t-90)*Math.PI/180;[45,135,225,315].includes(t)&&(this.ctx.lineWidth=this.radius/140,this.drawTriangle(i))}}drawAngleLabel(t,i,s){this.ctx.save(),this.ctx.translate(this.center.x+s*Math.cos(i),this.center.y+s*Math.sin(i)),this.ctx.rotate(i+Math.PI/2),this.ctx.lineWidth=this.radius/1e3,this.ctx.fillText(t,0,0),this.ctx.restore()}drawAndClear(t){this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let i=1;i<t.length;i++)this.ctx.lineTo(t[i].x,t[i].y);this.ctx.closePath(),this.ctx.save(),this.ctx.clip();const i=t.map((t=>t.x)),s=t.map((t=>t.y)),e=Math.min(...i),h=Math.min(...s),a=Math.max(...i),r=Math.max(...s);this.ctx.clearRect(e,h,a-e,r-h),this.ctx.restore(),this.ctx.stroke()}drawTriangle(t){const i=.765*this.radius,s=this.radius/45,e=this.center.x+i*Math.cos(t),h=this.center.y+i*Math.sin(t),a=i-3*s,r=t-Math.PI/65,c=t+Math.PI/65,n=this.center.x+a*Math.cos(r),x=this.center.y+a*Math.sin(r),l=this.center.x+a*Math.cos(c),o=this.center.y+a*Math.sin(c);this.drawAndClear([{x:e,y:h},{x:n,y:x},{x:l,y:o}])}draw4PointedStar(t,i,s){this.ctx.lineWidth=this.radius/170;for(let e=0;e<4;e++){const h=2*e*Math.PI/4-Math.PI/2+s,a=this.center.x+t*Math.cos(h),r=this.center.y+t*Math.sin(h),c=0===s?.915:.716;for(let t=-1;t<=1;t+=2){const s=h+t*Math.PI/4,e=a+(this.center.x+i*Math.cos(s)-a)*c,n=r+(this.center.y+i*Math.sin(s)-r)*c;this.drawAndClear([{x:this.center.x,y:this.center.y},{x:a,y:r},{x:e,y:n}]),-1!==t&&this.ctx.fill()}}}animateTo(t,i=10){const s=this.currentAngle,e=(t-s+360)%360,h=s+(e>180?e-360:e),a=performance.now(),r=t=>{const e=Math.min((t-a)/i,1),c=.5-.5*Math.cos(Math.PI*e);this.currentAngle=s+(h-s)*c,this.drawRotatedStars(this.currentAngle%360),e<1&&requestAnimationFrame(r)};requestAnimationFrame(r)}}export{t as default};
